<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../../../../javadoc.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a name="line.1">package com.box.sdk;</a>
<span class="sourceLineNo">002</span><a name="line.2"></a>
<span class="sourceLineNo">003</span><a name="line.3">import java.io.IOException;</a>
<span class="sourceLineNo">004</span><a name="line.4">import java.io.InputStreamReader;</a>
<span class="sourceLineNo">005</span><a name="line.5">import java.net.HttpURLConnection;</a>
<span class="sourceLineNo">006</span><a name="line.6">import java.util.Map;</a>
<span class="sourceLineNo">007</span><a name="line.7"></a>
<span class="sourceLineNo">008</span><a name="line.8">import com.eclipsesource.json.JsonObject;</a>
<span class="sourceLineNo">009</span><a name="line.9"></a>
<span class="sourceLineNo">010</span><a name="line.10">/**</a>
<span class="sourceLineNo">011</span><a name="line.11"> * Used to read HTTP responses containing JSON from the Box API.</a>
<span class="sourceLineNo">012</span><a name="line.12"> *</a>
<span class="sourceLineNo">013</span><a name="line.13"> * &lt;p&gt;This request type extends BoxAPIResponse to provide additional functionality for handling JSON strings. It reads</a>
<span class="sourceLineNo">014</span><a name="line.14"> * the response body into a string and allows the JSON in the response to be logged.&lt;/p&gt;</a>
<span class="sourceLineNo">015</span><a name="line.15"> */</a>
<span class="sourceLineNo">016</span><a name="line.16">public class BoxJSONResponse extends BoxAPIResponse {</a>
<span class="sourceLineNo">017</span><a name="line.17">    private static final int BUFFER_SIZE = 8192;</a>
<span class="sourceLineNo">018</span><a name="line.18">    private JsonObject jsonObject;</a>
<span class="sourceLineNo">019</span><a name="line.19"></a>
<span class="sourceLineNo">020</span><a name="line.20">    /**</a>
<span class="sourceLineNo">021</span><a name="line.21">     * Constructs a BoxJSONResponse without an associated HttpURLConnection.</a>
<span class="sourceLineNo">022</span><a name="line.22">     */</a>
<span class="sourceLineNo">023</span><a name="line.23">    public BoxJSONResponse() {</a>
<span class="sourceLineNo">024</span><a name="line.24">        super();</a>
<span class="sourceLineNo">025</span><a name="line.25">    }</a>
<span class="sourceLineNo">026</span><a name="line.26"></a>
<span class="sourceLineNo">027</span><a name="line.27">    /**</a>
<span class="sourceLineNo">028</span><a name="line.28">     * Constructs a BoxJSONResponse using an HttpURLConnection.</a>
<span class="sourceLineNo">029</span><a name="line.29">     * @param  connection a connection that has already sent a request to the API.</a>
<span class="sourceLineNo">030</span><a name="line.30">     */</a>
<span class="sourceLineNo">031</span><a name="line.31">    public BoxJSONResponse(HttpURLConnection connection) {</a>
<span class="sourceLineNo">032</span><a name="line.32">        super(connection);</a>
<span class="sourceLineNo">033</span><a name="line.33">    }</a>
<span class="sourceLineNo">034</span><a name="line.34"></a>
<span class="sourceLineNo">035</span><a name="line.35">    /**</a>
<span class="sourceLineNo">036</span><a name="line.36">     * Constructs a BoxAPIResponse with an http response code and response body.</a>
<span class="sourceLineNo">037</span><a name="line.37">     * @param responseCode http response code</a>
<span class="sourceLineNo">038</span><a name="line.38">     * @param httpHeaders map of http headers</a>
<span class="sourceLineNo">039</span><a name="line.39">     * @param body response body as Json Object</a>
<span class="sourceLineNo">040</span><a name="line.40">     */</a>
<span class="sourceLineNo">041</span><a name="line.41">    public BoxJSONResponse(int responseCode, Map&lt;String, String&gt; httpHeaders, JsonObject body) {</a>
<span class="sourceLineNo">042</span><a name="line.42">        super(responseCode, httpHeaders);</a>
<span class="sourceLineNo">043</span><a name="line.43">        this.jsonObject = body;</a>
<span class="sourceLineNo">044</span><a name="line.44">    }</a>
<span class="sourceLineNo">045</span><a name="line.45"></a>
<span class="sourceLineNo">046</span><a name="line.46">    /**</a>
<span class="sourceLineNo">047</span><a name="line.47">     * Get response as Json Object.</a>
<span class="sourceLineNo">048</span><a name="line.48">     * @return response as JsonObject</a>
<span class="sourceLineNo">049</span><a name="line.49">     */</a>
<span class="sourceLineNo">050</span><a name="line.50">    public JsonObject getJsonObject() {</a>
<span class="sourceLineNo">051</span><a name="line.51">        if (this.jsonObject != null) {</a>
<span class="sourceLineNo">052</span><a name="line.52">            return this.jsonObject;</a>
<span class="sourceLineNo">053</span><a name="line.53">        } else {</a>
<span class="sourceLineNo">054</span><a name="line.54">            return JsonObject.readFrom(this.getJSON());</a>
<span class="sourceLineNo">055</span><a name="line.55">        }</a>
<span class="sourceLineNo">056</span><a name="line.56">    }</a>
<span class="sourceLineNo">057</span><a name="line.57"></a>
<span class="sourceLineNo">058</span><a name="line.58">    /**</a>
<span class="sourceLineNo">059</span><a name="line.59">     * Gets the body of the response as a JSON string. When this method is called, the response's body will be read and</a>
<span class="sourceLineNo">060</span><a name="line.60">     * the response will be disconnected, meaning that the stream returned by {@link #getBody} can no longer be used.</a>
<span class="sourceLineNo">061</span><a name="line.61">     * @return the body of the response as a JSON string.</a>
<span class="sourceLineNo">062</span><a name="line.62">     */</a>
<span class="sourceLineNo">063</span><a name="line.63">    public String getJSON() {</a>
<span class="sourceLineNo">064</span><a name="line.64">        if (this.jsonObject != null) {</a>
<span class="sourceLineNo">065</span><a name="line.65">            return this.jsonObject.toString();</a>
<span class="sourceLineNo">066</span><a name="line.66">        } else {</a>
<span class="sourceLineNo">067</span><a name="line.67">            InputStreamReader reader = new InputStreamReader(this.getBody(), StandardCharsets.UTF_8);</a>
<span class="sourceLineNo">068</span><a name="line.68">            StringBuilder builder = new StringBuilder();</a>
<span class="sourceLineNo">069</span><a name="line.69">            char[] buffer = new char[BUFFER_SIZE];</a>
<span class="sourceLineNo">070</span><a name="line.70"></a>
<span class="sourceLineNo">071</span><a name="line.71">            try {</a>
<span class="sourceLineNo">072</span><a name="line.72">                int read = reader.read(buffer, 0, BUFFER_SIZE);</a>
<span class="sourceLineNo">073</span><a name="line.73">                while (read != -1) {</a>
<span class="sourceLineNo">074</span><a name="line.74">                    builder.append(buffer, 0, read);</a>
<span class="sourceLineNo">075</span><a name="line.75">                    read = reader.read(buffer, 0, BUFFER_SIZE);</a>
<span class="sourceLineNo">076</span><a name="line.76">                }</a>
<span class="sourceLineNo">077</span><a name="line.77"></a>
<span class="sourceLineNo">078</span><a name="line.78">                this.disconnect();</a>
<span class="sourceLineNo">079</span><a name="line.79">                reader.close();</a>
<span class="sourceLineNo">080</span><a name="line.80">            } catch (IOException e) {</a>
<span class="sourceLineNo">081</span><a name="line.81">                throw new BoxAPIException("Couldn't connect to the Box API due to a network error.", e);</a>
<span class="sourceLineNo">082</span><a name="line.82">            }</a>
<span class="sourceLineNo">083</span><a name="line.83">            this.jsonObject = JsonObject.readFrom(builder.toString());</a>
<span class="sourceLineNo">084</span><a name="line.84">            return builder.toString();</a>
<span class="sourceLineNo">085</span><a name="line.85">        }</a>
<span class="sourceLineNo">086</span><a name="line.86">    }</a>
<span class="sourceLineNo">087</span><a name="line.87"></a>
<span class="sourceLineNo">088</span><a name="line.88">    @Override</a>
<span class="sourceLineNo">089</span><a name="line.89">    protected String bodyToString() {</a>
<span class="sourceLineNo">090</span><a name="line.90">        String bodyString = super.bodyToString();</a>
<span class="sourceLineNo">091</span><a name="line.91">        if (bodyString == null) {</a>
<span class="sourceLineNo">092</span><a name="line.92">            return this.getJSON();</a>
<span class="sourceLineNo">093</span><a name="line.93">        } else {</a>
<span class="sourceLineNo">094</span><a name="line.94">            return bodyString;</a>
<span class="sourceLineNo">095</span><a name="line.95">        }</a>
<span class="sourceLineNo">096</span><a name="line.96">    }</a>
<span class="sourceLineNo">097</span><a name="line.97">}</a>




























































</pre>
</div>
</body>
</html>
